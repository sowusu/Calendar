<!DOCTYPE html>
<html>
<head><title>My Calendar</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Jquery -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<!-- Bootstrap -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">

<link rel="stylesheet" href="cal.css" type="text/css" media = "screen"/>

</head>

<body>

<header>
	Hunter and Nana's Calendar!! Wooot!!
</header>

<nav>
	<button id="PrevMonth">
	Previous Month

	</button>

	<label id="MonthName">Month</label>
	<button id="NextMonth">
		Next Month
	</button>
	<button>Example button</button>
	<!-- buttons and options go here-->
</nav>

<section class = "container-fluid" >
	<table id="dates" border="1">
		<tr>
			<th>
			Sunday
			</th>
			<th>
			Monday
			</th>
			<th>
			Tuesday
			</th>
			<th>
			Wednesday
			</th>
			<th>
			Thursday
			</th>
			<th>
			Friday
			</th>
			<th>
			Saturday
			</th>
		</tr>
	</table>
</section>


<label>Event: </label><textarea id="Event"></textarea>


<label>Month: </label><select id="Month" onchange='updateSelectedMonth(); updateDaySelect();'>
</select>

<label>Year: </label><input type="number" min="0" step="1" value="2015" id="Year" onchange='updateSelectedMonth(); updateDaySelect();'>

<label>Day: </label><input type="number" min="1" max="7" step="1" value="1" id="Day">
</select>

<label>Time: </label><select id="Time">
</select>

<script src="calendarHelper.js"></script>

<script type="text/javascript">
var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
var selectedMonth = new Month(2015, 0);
for(var i = 0; i < months.length; i++){
	var opt = document.createElement("option");
	opt.appendChild(document.createTextNode(months[i]));
	opt.setAttribute("value", i);
	document.getElementById("Month").appendChild(opt);
}
for(var j = 0; j <= 23; j++){
	for(var i = 0; i <= 30; i+=30){
		var opt = document.createElement("option");
		var jj = "" + j;
		var ii = "" + i;
		if(i==0){ii+="0";}
		if(j<10){jj="0"+jj;}
		opt.appendChild(document.createTextNode(jj + ":" + ii));
		opt.setAttribute("value", (jj + ":" + ii));
		document.getElementById("Time").appendChild(opt);
	}
}
document.getElementById("Month").value = 0;
function updateSelectedMonth(){
	var y = document.getElementById("Year").value;
	var m = document.getElementById("Month").value;
	selectedMonth = new Month(Number(y), Number(m));
}
function updateDaySelect(){
	var numDays = selectedMonth.nextMonth().getDateObject(0).getDate();
	var day = document.getElementById("Day");
	day.max = (numDays);
}
updateSelectedMonth();
updateDaySelect();
</script>
<button id="addEvent">Submit Event</button>

<script type="text/javascript">
var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
var currentMonth = new Month(2015, 2); //march 2015
var startDay = getMonthStartDay();
var jsonInfo;
/*
$("#addEvent").click(function(){
	
	$.ajax({url: "db_input.php", data :{"fire":"burning"}, success:function (result){
		alert(result);
	}

	}).done(function() {
    //alert( "success" );
    
  });



		"demo_test.txt", function(responseTxt, statusTxt, xhr){
    if(statusTxt == "success")
        alert("External content loaded successfully!");
    if(statusTxt == "error")
        alert("Error: " + xhr.status + ": " + xhr.statusText);
});

*/


function getMonthStartDay(){
	return currentMonth.getDateObject(1).getDay();
}
function removeDates(){
	var weeks = document.getElementById("dates").getElementsByClassName("week");
	var len = weeks.length;
	for(var i = 0; i < len; i++){
		document.getElementById("dates").removeChild(weeks[0]);
	}
}
function getDaysInMonth(){
	return currentMonth.nextMonth().getDateObject(0).getDate();
}
function addToCalendar(crntEvent){
	var newTr;
	var trIndex = 0;
	var jsondata = JSON.parse(crntEvent);
	for(var i=0;i<getDaysInMonth();i++){
		if(trIndex==0){
			newTr = document.createElement("tr");
			newTr.setAttribute("class", "week");
		}
		var events = eventsOnDay(i+1, jsondata);
		var newTd = document.createElement("td");	
		newTd.appendChild(document.createTextNode(months[currentMonth.month] + " " + (i+1)));
		newTd.appendChild(document.createElement("br"));
		for(var j = 0; j < events.length; j++){
			newTd.appendChild(document.createTextNode(events[j]));
			newTd.appendChild(document.createElement("br"));
		}	
		newTr.appendChild(newTd);
		trIndex=(trIndex+1)%7;
		if(i==getDaysInMonth()-1){
			for(;trIndex != 0; trIndex=(trIndex+1)%7){
				var newTd2 = document.createElement("td");
				newTd2.appendChild(document.createTextNode("X"));
				newTr.appendChild(newTd2);
			}
		}
		if(trIndex==0){
			document.getElementById("dates").appendChild(newTr);
		}
	}
}
var thisthis = 0;
function eventsOnDay(day, jsondata){
	var maxindex = jsondata.maxindex;
	var arr = [];
	for(var i=0;i<maxindex;i++){
		if(jsondata[i].day == day){
			arr.push(jsondata[i].time + " " + jsondata[i].event);
		}
	}
	return arr;
}
function displayDates(){
	newTr = document.createElement("tr");
//	newTr.setAttribute("class", "week");
//	var startDay = getMonthStartDay();
	var i;
	for(i = 0; i < startDay; i++){
		var newTd = document.createElement("td");
		newTd.appendChild(document.createTextNode("X"));
		newTr.appendChild(newTd);
		trIndex++;
	}
	var daysInMonth = getDaysInMonth();
	//for(var j = day; j < daysInMonth; j++){
		//var newTd = document.createElement("td");
		//var day = j-i+1;
		//newTd.appendChild(document.createTextNode(months[currentMonth.month] + " " + day));
		getEvent(currentMonth.month, currentMonth.year);
		//var jsondata = JSON.parse(crntEvent);
		//alert(jsondata.maxindex);
//	}
//	document.getElementById("dates").appendChild(newTr);
/*	for(var k = j-i; k < daysInMonth; k+=7){
		var newTr2 = document.createElement("tr");
		newTr2.setAttribute("class", "week");
		for(var l = 0; l < 7; l++){
			var newTd = document.createElement("td");
			if(k+l < daysInMonth){
				var day = k+l+1;;
				newTd.appendChild(document.createTextNode(months[currentMonth.month] + " " + day));
				getEvent(currentMonth.month, day, currentMonth.year);
				if(crntEvent!=null){
					newTd.appendChild(document.createTextNode(crntEvent));	
				}
			}
			else{
				newTd.appendChild(document.createTextNode("X"));
			}
			newTr2.appendChild(newTd);
		}
		document.getElementById("dates").appendChild(newTr2);
	}*/
}
displayDates();
function updateMonth(){
	var monthName = months[currentMonth.month];
	document.getElementById("MonthName").textContent = monthName + ", " + currentMonth.year;
}
function getEvent(month,year){
	var xmlHttp = new XMLHttpRequest();
	var u = "me";
	xmlHttp.open("GET", "db_retreive.php?month=" + months[month] + "&year=" + year + "&username=" + u, true);
	xmlHttp.addEventListener("load", ajaxCallback, false);
	xmlHttp.send(null);
}
function addEvent(){
	var xmlHttp = new XMLHttpRequest();
	var e = document.getElementById("Event").value;
	var m = document.getElementById("Month").value;
	var y = document.getElementById("Year").value;
	var d = document.getElementById("Day").value;
	var t = document.getElementById("Time").value;
	var u = "me";
	xmlHttp.open("GET", "db_input.php?event=" + e + "&month=" + months[m] + "&year=" + y + "&day=" + d + "&time=" + t + "&username=" + u, true);
	//xmlHttp.addEventListener("load", ajaxCallback, false);
	xmlHttp.send(null);
}
function ajaxCallback(event){
	//alert( "Your file contains the text: " + event.target.responseText );
	var crntEvent = event.target.responseText;
	//alert(crntEvent);
	addToCalendar(crntEvent);
}
updateMonth();
document.getElementById("PrevMonth").addEventListener("click", function(event){
	currentMonth = currentMonth.prevMonth(); // Previous month would be currentMonth.prevMonth()
	removeDates();
	displayDates();
	updateMonth();
}, false);
document.getElementById("NextMonth").addEventListener("click", function(event){
	currentMonth = currentMonth.nextMonth();
	removeDates();
	displayDates();
	updateMonth();
}, false);

document.getElementById("addEvent").addEventListener("click", function(event){
	addEvent();
}, false);
</script>
</body>
</html>
